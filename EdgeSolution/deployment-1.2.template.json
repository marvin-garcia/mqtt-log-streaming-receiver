{
  "modulesContent": {
    "$edgeAgent": {
      "properties.desired": {
        "schemaVersion": "1.1",
        "runtime": {
          "type": "docker",
          "settings": {
            "minDockerVersion": "v1.25",
            "registryCredentials": {
              "EdgeBuilds": {
                "address": "msiothack2022.azurecr.io",
                "username": "msiothack2022",
                "password": "9BXQXmmr30Jk=OcEfy9ZL5GyHt3/G3E3"
              }
            }
          }
        },
        "systemModules": {
          "edgeAgent": {
            "type": "docker",
            "settings": {
              "image": "mcr.microsoft.com/azureiotedge-agent:1.2",
              "createOptions": "{}"
            }
          },
          "edgeHub": {
            "type": "docker",
            "status": "running",
            "restartPolicy": "always",
            "settings": {
              "image": "mcr.microsoft.com/azureiotedge-hub:1.2",
              "createOptions": "{\"HostConfig\":{\"PortBindings\":{\"5671/tcp\":[{\"HostPort\":\"5671\"}],\"8883/tcp\":[{\"HostPort\":\"8883\"}],\"443/tcp\":[{\"HostPort\":\"443\"}],\"1883/tcp\":[{\"HostPort\":\"1883\"}]}}}"
            },
            "env": {
              "SslProtocols": {
                "value": "tls1.2"
              },
              "experimentalFeatures__mqttBrokerEnabled": {
                "value": "true"
              },
              "experimentalFeatures__enabled": {
                "value": "true"
              },
              "RuntimeLogLevel": {
                "value": "debug"
              }
            }
          }
        },
        "modules": {
          "__OBS_MODULE_NAME__": {
            "settings": {
              "image": "msiothack2022.azurecr.io/microsoft/azureiotedge-obsd:20220216.6-linux-amd64",
              "createOptions": "{\"HostConfig\":{\"Binds\":[\"/app/sensor/log:/app/sensor/log\"]}}"
            },
            "type": "docker",
            "status": "running",
            "restartPolicy": "always",
            "version": "1.0"
          }
        }
      }
    },
    "$edgeHub": {
      "properties.desired": {
        "schemaVersion": "1.2",
        "routes": {
          "Upstream": "FROM /messages/* INTO $upstream"
        },
        "storeAndForwardConfiguration": {
          "timeToLiveSecs": 7200
        },
        "mqttBroker": {
          "authorizations": __MQTT_BROKER_AUTH__
        }
      }
    },
    "__OBS_MODULE_NAME__": {
      "properties.desired": {
        "obsd_config": {
          "log_level": "info",
          "store_forward_file_path": "./kvstore.json",
          "receiver_specs": [
            {
              "receiver_spec_name": "MyAwesomeMqttLogReceiver",
              "receiver_type": "MqttLog",
              "mqtt_stream_settings": {
                "host": "localhost",
                "port": 8883,
                "topic": "opsagent/logs/#"
              },
              "stream_name": "sensor-mqtt",
              "stream_type": "JSON"
            },
            {
              "receiver_spec_name": "MyAwesomeFileLogReceiver",
              "receiver_type": "FileLog",
              "log_stream_settings": {
                "file_config": {
                  "include": [
                    "/app/sensor/log/*.log"
                  ]
                },
                "work_dir": "."
              },
              "stream_name": "sensor-log",
              "stream_type": "JSON"
            }
          ],
          "exporter_specs": [
            {
              "exporter_spec_name": "MyMqttLogExporter",
              "exporter_type": "LogAnalytics",
              "stream_name": "sensor-mqtt",
              "stream_type": "JSON",
              "export_frequency_in_seconds": 5,
              "run_time_seconds": 2,
              "conn_details": {
                "workspace_id": "__WORKSPACE_ID__",
                "shared_key": "__WORKSPACE_SHARED_KEY__",
                "log_type": "SensorLogMQTT"
              }
            },
            {
              "exporter_spec_name": "MyFileLogExporter",
              "exporter_type": "LogAnalytics",
              "stream_name": "sensor-log",
              "stream_type": "JSON",
              "export_frequency_in_seconds": 5,
              "run_time_seconds": 2,
              "conn_details": {
                "workspace_id": "__WORKSPACE_ID__",
                "shared_key": "__WORKSPACE_SHARED_KEY__",
                "log_type": "SensorLogFile"
              }
            }
          ]
        }
      }
    }
  }
}